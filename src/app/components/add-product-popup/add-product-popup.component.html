<!-- Popup Content -->
<div class="popup-container">
    <div class="popup-header">
        <h1>Add Product</h1>
        <button class="btn-close" (click)="cancel()" aria-label="Close">
            <i class="fas fa-times"></i>
        </button>
    </div>


    <div class="popup-content">
        <div class="product-info-section">
            <!-- Product Image -->
            <div class="product-image">
                <img [src]="data.product.image" alt="Product" class="product-img">
            </div>

            <!-- Product Info -->
            <div class="product-details">
                <h5>{{ data.product.name }}</h5>
                <p class="unit-price" *ngIf="!data.product.isPartialAllowed">
                  Unit Price: {{currency}}{{ data.product.price }}
                </p>
                <p class="unit-price" *ngIf="data.product.isPartialAllowed">
                  {{data.product.unitValue}}{{data.product.unit}} for {{currency}}{{ data.product.price }}
                </p>
            </div>
        </div>

        <!-- Input Controls Section -->
        <div class="input-controls-section">
            <!-- Quantity Controls -->
            <div *ngIf="!data.product.isPartialAllowed" class="quantity-control">
                <label>Quantity</label>
                <div class="input-with-buttons">
                    <button type="button" class="btn btn-outline-secondary btn-sm" (click)="decrease()" title="Decrease">
                        <i class="fas fa-minus"></i>
                    </button>
                    <input type="number" 
                           class="form-control quantity-input" 
                           [(ngModel)]="quantity" 
                           (ngModelChange)="validateQuantity()" 
                           min="1">
                    <button type="button" class="btn btn-outline-secondary btn-sm" (click)="increase()" title="Increase">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
            </div>

            <!-- Weight/Volume Input -->
            <div *ngIf="data.product.isPartialAllowed" class="size-control">
                <label>{{ getUnitLabel() }} ({{data.product.unit}})</label>
                <div class="input-with-buttons">
                    <button type="button" class="btn btn-outline-secondary btn-sm" (click)="decreaseSize()" title="Decrease">
                        <i class="fas fa-minus"></i>
                    </button>
                    <input type="number" 
                           [(ngModel)]="cartItem.size" 
                           class="form-control" 
                           min="0.01" 
                           step="0.01"
                           (ngModelChange)="onSizeChange($event)"
                           placeholder="e.g. 200">
                    <button type="button" class="btn btn-outline-secondary btn-sm" (click)="increaseSize()" title="Increase">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                <small class="text-muted">
                  Original package: {{data.product.unitValue}}{{data.product.unit}}
                </small>
            </div>

            <!-- Total Price -->
            <div class="price-control">
                <!-- If partial sale is allowed, show input for unit price -->
                <div *ngIf="data.product.isPartialAllowed; else readonlyPrice">
                    <label>Total Price {{currency}}</label>
                    <div class="input-with-buttons">
                        <button type="button" class="btn btn-outline-secondary btn-sm" (click)="decreasePrice()" title="Decrease">
                            <i class="fas fa-minus"></i>
                        </button>
                        <input type="number" 
                               [(ngModel)]="cartItem.total" 
                               (ngModelChange)="onPriceChange($event)"
                               class="form-control" 
                               min="0.01"
                               step="0.01"
                               placeholder="0.00">
                        <button type="button" class="btn btn-outline-secondary btn-sm" (click)="increasePrice()" title="Increase">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <small class="price-per-unit">
                      Rate: {{currency}}{{ getPricePerUnit().toFixed(2) }} per {{data.product.unit}}
                    </small>
                </div>
                <!-- Readonly price if partial sale not allowed -->
                <ng-template #readonlyPrice>
                    <label>Total Price</label>
                    <div class="total-price-display">{{currency}} {{ totalPrice }}</div>
                </ng-template>
            </div>
        </div>
    </div>


    <div class="popup-footer">
        <button class="btn btn-outline-secondary" (click)="cancel()">Cancel</button>
        <button class="btn btn-primary" (click)="addProduct()">Add to Cart</button>
    </div>
</div>