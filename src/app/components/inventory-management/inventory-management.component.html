<div class="inventory-management-container">
  <div class="inventory-management-content">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h1 class="h3 mb-0">
        <i class="fas fa-boxes me-2"></i>
        Inventory Management
      </h1>
      <div class="d-flex gap-2">
        <button class="btn btn-outline-primary" (click)="exportInventoryReport()">
          <i class="fas fa-download me-2"></i>
          Export Report
        </button>
        <button class="btn btn-primary" routerLink="/add-product">
          <i class="fas fa-plus me-2"></i>
          Add Product
        </button>
      </div>
    </div>

    <!-- Statistics Cards -->
    <div class="row mb-4">
      <div class="col-md-3">
        <div class="card border-primary">
          <div class="card-body text-center">
            <i class="fas fa-box fa-2x mb-2"></i>
            <h6 class="card-title">Total Products</h6>
            <h4>{{ stats.totalProducts }}</h4>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card border-success">
          <div class="card-body text-center">
            <i class="fas fa-dollar-sign fa-2x mb-2"></i>
            <h6 class="card-title">Total Value</h6>
            <h4>{{ currency }}{{ stats.totalStockValue | number:'1.2-2' }}</h4>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card border-warning">
          <div class="card-body text-center">
            <i class="fas fa-exclamation-triangle fa-2x mb-2"></i>
            <h6 class="card-title">Low Stock</h6>
            <h4>{{ stats.lowStockItems }}</h4>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card border-danger">
          <div class="card-body text-center">
            <i class="fas fa-times-circle fa-2x mb-2"></i>
            <h6 class="card-title">Out of Stock</h6>
            <h4>{{ stats.outOfStockItems }}</h4>
          </div>
        </div>
      </div>
    </div>

    <!-- Search and Filter Controls -->
    <div class="card mb-4 search-filter-card">
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-4">
            <label for="searchInput" class="form-label">Search Products</label>
            <input 
              type="text" 
              id="searchInput"
              class="form-control" 
              placeholder="Search by name or ID..."
              [(ngModel)]="searchQuery"
              (ngModelChange)="onSearchChange()">
          </div>
          <div class="col-md-3">
            <label for="statusFilter" class="form-label">Stock Status</label>
            <select 
              id="statusFilter"
              class="form-select" 
              [(ngModel)]="filterStatus"
              (change)="onFilterChange()">
              <option value="all">All Items</option>
              <option value="in-stock">In Stock</option>
              <option value="low-stock">Low Stock</option>
              <option value="out-of-stock">Out of Stock</option>
            </select>
          </div>
          <div class="col-md-3">
            <label for="sortBy" class="form-label">Sort By</label>
            <select 
              id="sortBy"
              class="form-select" 
              [(ngModel)]="sortBy"
              (change)="onSortChange()">
              <option value="name">Product Name</option>
              <option value="stock">Current Stock</option>
              <option value="value">Stock Value</option>
              <option value="lastUpdated">Last Updated</option>
            </select>
          </div>
          <div class="col-md-2">
            <label for="sortOrder" class="form-label">Order</label>
            <select 
              id="sortOrder"
              class="form-select" 
              [(ngModel)]="sortOrder"
              (change)="onSortChange()">
              <option value="asc">↑</option>
              <option value="desc">↓</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- Inventory Table -->
    <div class="card inventory-table-card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">
          <i class="fas fa-list me-2"></i>
          Inventory Items ({{ filteredItems.length }} items)
          <small class="text-muted ms-2">
            <span *ngIf="searchQuery">Search: "{{ searchQuery }}"</span>
            <span *ngIf="filterStatus !== 'all'">Status: {{ filterStatus }}</span>
            <span *ngIf="sortBy">Sort: {{ sortBy }} ({{ sortOrder }})</span>
          </small>
        </h5>
        <div class="d-flex gap-2">
          <button 
            class="btn btn-sm btn-outline-secondary" 
            (click)="selectAll()"
            [disabled]="paginatedItems.length === 0">
            Select All
          </button>
          <button 
            class="btn btn-sm btn-outline-secondary" 
            (click)="deselectAll()"
            [disabled]="selectedItems.length === 0">
            Deselect All
          </button>
        </div>
      </div>
      
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead class="table-dark">
              <tr>
                <th width="50">
                  <input 
                    type="checkbox" 
                    class="form-check-input"
                    [checked]="selectedItems.length === paginatedItems.length && paginatedItems.length > 0"
                    (change)="selectedItems.length === paginatedItems.length ? deselectAll() : selectAll()">
                </th>
                <th>Product</th>
                <th>Current Stock</th>
                <th>Stock Status</th>
                <th>Stock Value</th>
                <th>Low Stock Threshold</th>
                <th>Reorder Point</th>
                <th>Last Updated</th>
                <th width="120">Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of paginatedItems">
                <td>
                  <input 
                    type="checkbox" 
                    class="form-check-input"
                    [checked]="selectedItems.includes(item.product.id)"
                    (change)="toggleItemSelection(item.product.id)">
                </td>
                <td>
                  <div class="d-flex align-items-center">
                    <img 
                      [src]="item.product.image || 'assets/images/placeholder.png'" 
                      [alt]="item.product.name"
                      class="rounded me-2"
                      width="40" 
                      height="40"
                      style="object-fit: cover;">
                    <div>
                      <strong>{{ item.product.name }}</strong>
                      <br>
                      <small class="text-muted">ID: {{ item.product.id }}</small>
                    </div>
                  </div>
                </td>
                <td>
                  <div class="d-flex align-items-center">
                    <input 
                      type="number" 
                      class="form-control form-control-sm stock-input me-2" 
                      [value]="item.currentStock"
                      (blur)="updateStockFromInput(item, $event)"
                      (keyup.enter)="updateStockFromInput(item, $event)"
                      min="0"
                      style="width: 80px;">
                    <span class="fw-bold" [class]="item.currentStock <= item.lowStockThreshold ? 'text-warning' : 'text-success'">
                      {{ item.currentStock }}
                    </span>
                  </div>
                </td>
                <td>
                  <span [class]="getStockStatusClass(item.stockStatus)">
                    {{ item.stockStatus }}
                  </span>
                </td>
                <td>
                  <strong>{{ currency }}{{ item.stockValue | number:'1.2-2' }}</strong>
                </td>
                <td>{{ item.lowStockThreshold }}</td>
                <td>{{ item.reorderPoint }}</td>
                <td>
                  <small>{{ item.lastUpdated | date:'MMM dd, yyyy HH:mm' }}</small>
                </td>
                <td>
                  <div class="btn-group btn-group-sm">
                    <button 
                      class="btn btn-outline-primary"
                      title="Update Stock"
                      (click)="updateStock(item, item.currentStock + 1)">
                      <i class="fas fa-plus"></i>
                    </button>
                    <button 
                      class="btn btn-outline-warning"
                      title="Decrease Stock"
                      (click)="updateStock(item, Math.max(0, item.currentStock - 1))">
                      <i class="fas fa-minus"></i>
                    </button>
                    <button 
                      class="btn btn-outline-info"
                      title="Edit Product"
                      (click)="editProduct(item.product.id)">
                      <i class="fas fa-edit"></i>
                    </button>
                  </div>
                </td>
              </tr>
              <tr *ngIf="paginatedItems.length === 0">
                <td colspan="9" class="text-center text-muted py-4">
                  <i class="fas fa-box-open fa-3x mb-3"></i>
                  <p class="mb-0">No inventory items found</p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- Pagination -->
      <div class="card-footer" *ngIf="totalPages > 1">
        <nav aria-label="Inventory pagination">
          <ul class="pagination justify-content-center mb-0">
            <li class="page-item" [class.disabled]="currentPage === 1">
              <a class="page-link" href="#" (click)="onPageChange(currentPage - 1); $event.preventDefault()">
                <i class="fas fa-chevron-left"></i>
              </a>
            </li>
            <li class="page-item" *ngFor="let page of [].constructor(totalPages); let i = index" 
                [class.active]="currentPage === i + 1">
              <a class="page-link" href="#" (click)="onPageChange(i + 1); $event.preventDefault()">
                {{ i + 1 }}
              </a>
            </li>
            <li class="page-item" [class.disabled]="currentPage === totalPages">
              <a class="page-link" href="#" (click)="onPageChange(currentPage + 1); $event.preventDefault()">
                <i class="fas fa-chevron-right"></i>
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </div>

    <!-- Reorder List -->
    <div class="card mt-4" *ngIf="generateReorderList().length > 0">
      <div class="card-header">
        <h5 class="mb-0 text-warning">
          <i class="fas fa-exclamation-triangle me-2"></i>
          Reorder List ({{ generateReorderList().length }} items)
        </h5>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6" *ngFor="let item of generateReorderList()">
            <div class="d-flex justify-content-between align-items-center p-2 border rounded mb-2">
              <div>
                <strong>{{ item.product.name }}</strong>
                <br>
                <small class="text-muted">Current: {{ item.currentStock }} | Reorder Point: {{ item.reorderPoint }}</small>
              </div>
              <span class="badge bg-warning">Needs Reorder</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
