<div class="container mt-4">
  <div class="row">
    <div class="col-12">
      <h1 class="mb-4">
        <i class="fas fa-chart-line me-3"></i>Sales Analysis
      </h1>
      
      <!-- Date Range Picker -->
      <div class="row mb-4">
        <div class="col-md-4">
          <label for="startDate" class="form-label">
            <i class="fas fa-calendar-alt me-2"></i>Start Date
          </label>
          <input 
            type="date" 
            id="startDate"
            class="form-control" 
            [(ngModel)]="startDate" 
            (change)="onDateRangeChange()"
          />
        </div>
        <div class="col-md-4">
          <label for="endDate" class="form-label">
            <i class="fas fa-calendar-alt me-2"></i>End Date
          </label>
          <input 
            type="date" 
            id="endDate"
            class="form-control" 
            [(ngModel)]="endDate" 
            (change)="onDateRangeChange()"
          />
        </div>
        <div class="col-md-4 d-flex align-items-end">
          <button 
            class="btn btn-primary" 
            (click)="loadSalesAnalysis()"
            [disabled]="isLoading">
            <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
            <i *ngIf="!isLoading" class="fas fa-search me-2"></i>
            Refresh Analysis
          </button>
        </div>
      </div>

      <!-- Sales Summary Cards -->
      <div class="row mb-4">
        <div class="col-md-3">
          <div class="card text-center border-success">
            <div class="card-body">
              <i class="fas fa-dollar-sign fa-2x text-success mb-2"></i>
              <h5 class="card-title">Total Sales</h5>
              <h3 class="text-success">{{currency}}{{totalSales | number:'1.2-2'}}</h3>
              <small class="text-muted">Revenue Generated</small>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-center border-primary">
            <div class="card-body">
              <i class="fas fa-shopping-cart fa-2x text-primary mb-2"></i>
              <h5 class="card-title">Total Orders</h5>
              <h3 class="text-primary">{{totalOrders}}</h3>
              <small class="text-muted">Orders Placed</small>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-center border-info">
            <div class="card-body">
              <i class="fas fa-chart-line fa-2x text-info mb-2"></i>
              <h5 class="card-title">Average Order Value</h5>
              <h3 class="text-info">{{currency}}{{averageOrderValue | number:'1.2-2'}}</h3>
              <small class="text-muted">Per Order</small>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-center border-warning">
            <div class="card-body">
              <i class="fas fa-box fa-2x text-warning mb-2"></i>
              <h5 class="card-title">Products Sold</h5>
              <h3 class="text-warning">{{ getTotalProductsSold() }}</h3>
              <small class="text-muted">Total Units</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Additional Metrics Row -->
      <div class="row mb-4">
        <div class="col-md-4">
          <div class="card text-center border-secondary">
            <div class="card-body">
              <i class="fas fa-calendar-alt fa-2x text-secondary mb-2"></i>
              <h6 class="card-title">Date Range</h6>
              <p class="text-muted mb-1">{{ startDate | date:'MMM dd, yyyy' }}</p>
              <p class="text-muted">to {{ endDate | date:'MMM dd, yyyy' }}</p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card text-center border-dark">
            <div class="card-body">
              <i class="fas fa-trophy fa-2x text-warning mb-2"></i>
              <h6 class="card-title">Top Product</h6>
              <p class="text-dark mb-0">{{ getTopSellingProduct() }}</p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card text-center border-danger">
            <div class="card-body">
              <i class="fas fa-chart-pie fa-2x text-danger mb-2"></i>
              <h6 class="card-title">Unique Products</h6>
              <h4 class="text-danger">{{ productSalesData.length }}</h4>
              <small class="text-muted">Different Items Sold</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Sales Trend Table -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">Daily Sales Breakdown</h5>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-striped table-hover">
                  <thead class="table-dark">
                    <tr>
                      <th>Date</th>
                      <th>Total Sales</th>
                      <th>Order Count</th>
                      <th>Average Order Value</th>
                      <th>Top Product</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let dayData of getDailySalesData()">
                      <td>{{ dayData.date | date:'MMM dd, yyyy' }}</td>
                      <td>{{ currency }}{{ dayData.totalSales | number:'1.2-2' }}</td>
                      <td>{{ dayData.orderCount }}</td>
                      <td>{{ currency }}{{ dayData.averageOrderValue | number:'1.2-2' }}</td>
                      <td>{{ dayData.topProduct }}</td>
                    </tr>
                    <tr *ngIf="getDailySalesData().length === 0">
                      <td colspan="5" class="text-center text-muted">
                        <i class="fas fa-chart-line me-2"></i>
                        No sales data available for the selected date range
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Product Sales Details -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">Product Sales Details</h5>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-striped table-hover">
                  <thead class="table-dark">
                    <tr>
                      <th>Product ID</th>
                      <th>Product Name</th>
                      <th>Total Quantity Sold</th>
                      <th>Total Revenue</th>
                      <th>Orders Count</th>
                      <th>Average per Order</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let product of productSalesData; let i = index">
                      <td>
                        <span class="badge bg-primary">{{product.productId}}</span>
                      </td>
                      <td>
                        <span class="badge bg-secondary me-2">{{ i + 1 }}</span>
                        <strong>{{product.productName}}</strong>
                      </td>
                      <td>
                        <span class="badge bg-info">{{product.totalQuantity}}</span>
                      </td>
                      <td>
                        <strong class="text-success">{{currency}}{{product.totalRevenue | number:'1.2-2'}}</strong>
                      </td>
                      <td>
                        <span class="badge bg-warning">{{product.orderCount}}</span>
                      </td>
                      <td>
                        <span class="text-primary">{{currency}}{{(product.totalRevenue / product.orderCount) | number:'1.2-2'}}</span>
                      </td>
                    </tr>
                    <tr *ngIf="productSalesData.length === 0">
                      <td colspan="6" class="text-center text-muted">
                        <i class="fas fa-box me-2"></i>
                        No product sales data available for the selected date range
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Order Details Section -->
      <div class="row">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">Order Details ({{startDate}} to {{endDate}})</h5>
            </div>
            <div class="card-body">
              <!-- Use the existing view orders component -->
              <app-view-orders 
                [filteredOrders]="getFilteredOrders()"
                [dateFilter]="getDateRangeFilter()"
                [hideDatePicker]="true">
              </app-view-orders>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>